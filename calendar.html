<!DOCTYPE html>
<html>
<head>
    <title>Calendar View</title>
    <meta charset="UTF-8">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #121212;
            color: #e0e0e0;
        }

        /* ------------------------------
           TOP NAV MENU
        ------------------------------ */
        #topMenu {
            width: 100%;
            text-align: center;
            margin-bottom: 25px;
            font-size: 20px;
        }

        #topMenu a {
            color: #b0b0b0;
            text-decoration: none;
            margin: 0 20px;
            padding: 6px 14px;
            border-radius: 6px;
            transition: 0.2s;
        }

        #topMenu a:hover {
            background: #1f1f1f;
            color: #ffffff;
        }

        #topMenu .active {
            background: #2a2a2a;
            color: #ffffff;
            font-weight: bold;
        }

        /* ------------------------------
           CALENDAR CONTAINER
        ------------------------------ */
        #calendarContainer {
            width: 1000px;
            margin: 0 auto;
        }

        /* ------------------------------
           MONTH TITLE + ARROWS
        ------------------------------ */
        #monthTitle {
            text-align: center;
            font-size: 32px;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
        }

        #monthTitle button {
            background: #1f4fd4;        /* Clock Out blue */
            color: white;
            border: none;
            padding: 18px 32px;
            font-size: 32px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #monthTitle button:hover {
            background: #3a6af0;
            transform: scale(1.10);
        }

        /* ------------------------------
           CALENDAR GRID
        ------------------------------ */
        #calendarGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .dayHeader {
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            background: #1f1f1f;
            border-radius: 6px;
            color: #1f4fd4; /* Clock Out blue */
        }

        .dayCell {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 10px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            font-size: 18px;
            cursor: pointer;
            transition: 0.15s ease;
        }

        .dayCell:hover {
            background: #252525;
        }

        .dayNumber {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
            color: #ffffff;
        }

        .hoursText {
            font-size: 18px;
            color: #e8d63a;
        }

        /* ------------------------------
           SELECTED DAY (blue highlight)
        ------------------------------ */
        .dayCell.selected {
            background: #1f4fd4 !important;
            border-color: #3a6af0 !important;
            color: white !important;
            transform: scale(1.03);
        }

        .dayCell.selected .dayNumber {
            color: white !important;
        }

        .dayCell.selected .hoursText {
            color: #ffe066 !important; /* yellow pop */
        }
    </style>
</head>
<body>

<!-- TOP NAVIGATION MENU -->
<div id="topMenu">
    <a href="index.html">Time Log</a>
    <a href="calendar.html" class="active">Calendar</a>
</div>

<div id="calendarContainer">

    <!-- MONTH TITLE + ARROWS -->
    <div id="monthTitle">
        <button id="prevMonthBtn">⟨</button>
        <span id="monthLabel">Loading…</span>
        <button id="nextMonthBtn">⟩</button>
    </div>

    <!-- CALENDAR GRID -->
    <div id="calendarGrid">
        <!-- Weekday headers (Monday start) -->
        <div class="dayHeader">Mon</div>
        <div class="dayHeader">Tue</div>
        <div class="dayHeader">Wed</div>
        <div class="dayHeader">Thu</div>
        <div class="dayHeader">Fri</div>
        <div class="dayHeader">Sat</div>
        <div class="dayHeader">Sun</div>
    </div>

</div>

<!-- TOTAL HOURS COUNTER -->
<div id="selectedTotal"
     style="text-align:center; font-size:26px; margin-top:25px; color:#e8d63a; font-weight:bold;">
    Selected Hours: 0.00h
</div>
<script>
/* ----------------------------------------
   LOAD LOGS FROM LOCALSTORAGE
---------------------------------------- */
let logs = JSON.parse(localStorage.getItem("timeLogs") || "[]");

/* ----------------------------------------
   CURRENT VIEWED MONTH/YEAR
---------------------------------------- */
let viewYear = new Date().getFullYear();
let viewMonth = new Date().getMonth(); // 0–11

/* Track selected days */
let selectedDays = new Set();

/* Month names */
const monthNames = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
];

/* ----------------------------------------
   UPDATE SELECTED TOTAL HOURS
---------------------------------------- */
function updateSelectedTotal(hoursByDay) {
    let total = 0;

    selectedDays.forEach(day => {
        if (hoursByDay[day]) {
            total += hoursByDay[day];
        }
    });

    document.getElementById("selectedTotal").textContent =
        "Selected Hours: " + total.toFixed(2) + "h";
}

/* ----------------------------------------
   RENDER CALENDAR
---------------------------------------- */
function renderCalendar() {
    const monthLabel = document.getElementById("monthLabel");
    const grid = document.getElementById("calendarGrid");

    monthLabel.textContent = monthNames[viewMonth] + " " + viewYear;

    /* Reset selection when switching months */
    selectedDays.clear();
    document.getElementById("selectedTotal").textContent = "Selected Hours: 0.00h";

    /* Clear old cells (keep weekday headers) */
    grid.innerHTML = `
        <div class="dayHeader">Mon</div>
        <div class="dayHeader">Tue</div>
        <div class="dayHeader">Wed</div>
        <div class="dayHeader">Thu</div>
        <div class="dayHeader">Fri</div>
        <div class="dayHeader">Sat</div>
        <div class="dayHeader">Sun</div>
    `;

    const firstDay = new Date(viewYear, viewMonth, 1);
    const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();

    /* Monday-start offset */
    let startOffset = firstDay.getDay(); // 0=Sun
    if (startOffset === 0) startOffset = 7;
    startOffset -= 1;

    /* Sum hours per day */
    let hoursByDay = {};

    logs.forEach(entry => {
        if (entry.action !== "Clock Out") return;

        const [d, m, y] = entry.date.split("/").map(Number);

        if (m - 1 === viewMonth && y === viewYear) {
            const day = d;
            const hours = parseFloat(entry.hours || "0");

            if (!hoursByDay[day]) hoursByDay[day] = 0;
            hoursByDay[day] += hours;
        }
    });

    /* Add blank cells before day 1 */
    for (let i = 0; i < startOffset; i++) {
        const empty = document.createElement("div");
        empty.className = "dayCell";
        grid.appendChild(empty);
    }

    /* Add actual days */
    for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement("div");
        cell.className = "dayCell";
        cell.dataset.day = day;

        const num = document.createElement("div");
        num.className = "dayNumber";
        num.textContent = day;
        cell.appendChild(num);

        if (hoursByDay[day]) {
            const hrs = document.createElement("div");
            hrs.className = "hoursText";
            hrs.textContent = hoursByDay[day].toFixed(2) + "h";
            cell.appendChild(hrs);
        }

        /* CLICK TO SELECT / DESELECT */
        cell.onclick = () => {
            if (selectedDays.has(day)) {
                selectedDays.delete(day);
                cell.classList.remove("selected");
            } else {
                selectedDays.add(day);
                cell.classList.add("selected");
            }
            updateSelectedTotal(hoursByDay);
        };

        grid.appendChild(cell);
    }
}

/* ----------------------------------------
   MONTH SWITCHING
---------------------------------------- */
document.getElementById("prevMonthBtn").onclick = () => {
    viewMonth--;
    if (viewMonth < 0) {
        viewMonth = 11;
        viewYear--;
    }
    renderCalendar();
};

document.getElementById("nextMonthBtn").onclick = () => {
    viewMonth++;
    if (viewMonth > 11) {
        viewMonth = 0;
        viewYear++;
    }
    renderCalendar();
};

/* ----------------------------------------
   INITIAL RENDER
---------------------------------------- */
renderCalendar();
</script>

</body>
</html>
