<!DOCTYPE html>
<html>
<head>
    <title>Time Tracker</title>
    <meta charset="UTF-8">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #121212;
            color: #e0e0e0;
        }

        h1 {
            text-align: center;
            color: #ffffff;
        }

        /* ------------------------------
           TOP NAV MENU
        ------------------------------ */
        #topMenu {
            width: 100%;
            text-align: center;
            margin-bottom: 25px;
            font-size: 20px;
        }

        #topMenu a {
            color: #b0b0b0;
            text-decoration: none;
            margin: 0 20px;
            padding: 6px 14px;
            border-radius: 6px;
            transition: 0.2s;
        }

        #topMenu a:hover {
            background: #1f1f1f;
            color: #ffffff;
        }

        #topMenu .active {
            background: #2a2a2a;
            color: #ffffff;
            font-weight: bold;
        }

        /* ------------------------------
           LIVE CLOCK + STATUS
        ------------------------------ */
        #liveClock {
            text-align: center;
            font-size: 32px;
            margin-bottom: 10px;
            color: #b0b0b0;
        }

        #statusText {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            color: #e8d63a;
        }

        /* ------------------------------
           RESET + DOWNLOAD BUTTONS
        ------------------------------ */
        #resetBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 18px;
            background: #2a2a2a;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }
        #resetBtn:hover {
            background: #3a3a3a;
        }

        #downloadBtn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #2a2a2a;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: 0.2s;
        }
        #downloadBtn:hover {
            background: #3a3a3a;
        }

        /* ------------------------------
           MAIN BUTTONS
        ------------------------------ */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        button {
            padding: 30px 50px;
            font-size: 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #clockInBtn {
            background: #d4c21f;
            color: black;
        }
        #clockInBtn:hover:not(.disabledBtn) {
            background: #e8d63a;
            transform: scale(1.05);
        }

        #clockOutBtn {
            background: #1f4fd4;
            color: white;
        }
        #clockOutBtn:hover:not(.disabledBtn) {
            background: #3a6af0;
            transform: scale(1.05);
        }

        .disabledBtn {
            background: #000 !important;
            color: #666 !important;
            cursor: not-allowed !important;
            opacity: 0.6;
            transform: none !important;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0.95;
            pointer-events: none;
        }

        /* ------------------------------
           TABLE
        ------------------------------ */
        #scrollArea {
            max-height: 650px;
            overflow-y: auto;
            margin-top: 25px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #1e1e1e;
            color: #e0e0e0;
        }

        th, td {
            padding: 4px 6px;
            border: 1px solid #333;
            text-align: center;
        }

        th {
            background: #272727;
        }

        td.actionCell {
            width: 40px;
        }

        /* Delete button */
        .deleteBtn {
            background: none;
            border: none;
            color: #ff5555;
            font-size: 20px;
            cursor: pointer;
            transition: 0.2s;
        }
        .deleteBtn:hover {
            color: #ff7777;
            transform: scale(1.2);
        }

        /* Edit button */
        .editBtn {
            background: none;
            border: none;
            color: #55aaff;
            font-size: 20px;
            cursor: pointer;
            margin-right: 5px;
            transition: 0.2s;
        }
        .editBtn:hover {
            color: #77bbff;
            transform: scale(1.2);
        }

        /* Alternating day colors */
        .dayA {
            background: #1a1a1a;
        }
        .dayB {
            background: #222222;
        }

        /* Action colors */
        .action-in {
            color: #e8d63a;
            font-weight: bold;
        }
        .action-out {
            color: #3a6af0;
            font-weight: bold;
        }

        /* Edited row animation */
        .edited {
            animation: glow 1.5s ease;
        }
        @keyframes glow {
            0% { background-color: #444; }
            100% { background-color: inherit; }
        }

        /* ------------------------------
           MODAL
        ------------------------------ */
        #modalOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
        }

        #editModal {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
            border: 1px solid #444;
        }

        #editModal input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            background: #2a2a2a;
            border: 1px solid #555;
            color: white;
            border-radius: 6px;
        }

        #errorMsg {
            color: #ff5555;
            font-size: 14px;
            min-height: 20px;
        }

        /* ----------------------------------------------
       MOBILE LAYOUT (Clock In/Out bigger + stacked)
        ---------------------------------------------- */
        @media (max-width: 700px) {

            /* Stack the buttons vertically */
            #buttonRow {
                display: flex;
                flex-direction: column;
                gap: 20px;
                width: 100%;
            }

            /* Make each button full-width and bigger */
            #clockInBtn,
            #clockOutBtn {
                width: 100%;
                padding: 28px 0;          /* bigger tap area */
                font-size: 28px;          /* larger text */
                border-radius: 14px;      /* slightly rounder */
            }

            /* Optional: add a little breathing room */
            body {
                padding: 20px;
            }
        }

    </style>
</head>
<body>

<!-- TOP NAVIGATION MENU -->
<div id="topMenu">
    <a href="index.html" class="active">Time Log</a>
    <a href="calendar.html">Calendar</a>
</div>

<button id="resetBtn" onclick="confirmReset()">Reset</button>
<button id="downloadBtn" onclick="downloadCSV()">Download</button>

<h1>Time Tracker</h1>

<div id="liveClock">--:--:--</div>
<div id="statusText">Status: No entries yet</div>

<div class="button-container">
    <button id="clockInBtn" class="tooltip" onclick="record('Clock In')">Clock In</button>
    <button id="clockOutBtn" class="tooltip" onclick="record('Clock Out')">Clock Out</button>
</div>

<div id="scrollArea">
    <table id="logTable">
        <thead>
            <tr>
                <th>Shift</th>
                <th>Action</th>
                <th>Date</th>
                <th>Time</th>
                <th>Hours</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Modal -->
<div id="modalOverlay">
    <div id="editModal">
        <h3>Edit Entry</h3>
        <input id="editDate" placeholder="DD/MM/YYYY">
        <input id="editTime" placeholder="HH:MM">
        <div id="errorMsg"></div>
        <button onclick="saveEdit()">Save</button>
        <button onclick="closeModal()">Cancel</button>
    </div>
</div>
<script>
/* ------------------------------
   GLOBAL STATE
------------------------------ */
let logs = JSON.parse(localStorage.getItem("timeLogs") || "[]");
let editingId = null;

/* Generate safe unique IDs */
function newId() {
    return crypto.randomUUID
        ? crypto.randomUUID()
        : Date.now().toString(36) + Math.random().toString(36).slice(2);
}

/* ------------------------------
   LIVE CLOCK
------------------------------ */
function updateClock() {
    document.getElementById("liveClock").textContent =
        new Date().toLocaleTimeString([], {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
}
setInterval(updateClock, 1000);
updateClock();

/* ------------------------------
   DATE PARSING (UK FORMAT)
------------------------------ */
function parseUkDateTime(dateStr, timeStr) {
    const [d, m, y] = dateStr.split('/').map(Number);
    const [hh, mm] = timeStr.split(':').map(Number);
    return new Date(y, m - 1, d, hh, mm);
}

/* ------------------------------
   SHIFT + HOURS CALCULATION
   Strict pairing:
   Clock In + Clock Out = 1 shift
------------------------------ */
function calculateShifts() {
    let shift = 0;
    let lastIn = null;

    const chronological = [...logs].sort((a, b) => a.timestamp - b.timestamp);

    chronological.forEach(e => {
        e.shift = "";
        e.hours = "";
    });

    chronological.forEach(entry => {
        if (entry.action === "Clock In") {
            lastIn = entry;
        } 
        else if (entry.action === "Clock Out" && lastIn) {
            shift++;

            const diffHours = (entry.timestamp - lastIn.timestamp) / 3600000;
            const hours = diffHours.toFixed(2);

            // Clock Out row gets values
            entry.shift = shift;
            entry.hours = hours;

            // Clock In row stays blank
            lastIn.shift = "";
            lastIn.hours = "";

            lastIn = null;
        }
    });

    logs.forEach(entry => {
        const match = chronological.find(c => c.id === entry.id);
        entry.shift = match.shift;
        entry.hours = match.hours;
    });
}

/* ------------------------------
   UPDATE BUTTON STATES
------------------------------ */
function updateButtons() {
    const last = logs[0] ? logs[0].action : null;

    const inBtn = document.getElementById("clockInBtn");
    const outBtn = document.getElementById("clockOutBtn");
    const status = document.getElementById("statusText");

    inBtn.disabled = false;
    outBtn.disabled = false;
    inBtn.classList.remove("disabledBtn");
    outBtn.classList.remove("disabledBtn");
    inBtn.removeAttribute("data-tip");
    outBtn.removeAttribute("data-tip");

    if (!last) {
        status.textContent = "Status: No entries yet";
        return;
    }

    if (last === "Clock In") {
        inBtn.disabled = true;
        inBtn.classList.add("disabledBtn");
        inBtn.setAttribute("data-tip", "You must clock out before clocking in again");
        status.textContent = "Status: You are currently clocked in";
    } 
    else if (last === "Clock Out") {
        outBtn.disabled = true;
        outBtn.classList.add("disabledBtn");
        outBtn.setAttribute("data-tip", "You must clock in before clocking out again");
        status.textContent = "Status: You are currently clocked out";
    }
}

/* ------------------------------
   RECORD ENTRY
------------------------------ */
function record(action) {
    const last = logs[0] ? logs[0].action : null;
    if (action === last) return;

    const now = new Date();

    logs.unshift({
        id: newId(),
        action,
        date: now.toLocaleDateString(),
        time: now.toLocaleTimeString([], {
            hour: '2-digit',
            minute: '2-digit'
        }),
        timestamp: now.getTime(),
        shift: "",
        hours: ""
    });

    calculateShifts();
    localStorage.setItem("timeLogs", JSON.stringify(logs));
    renderTable();
}
/* ------------------------------
   EDIT ENTRY
------------------------------ */
function editEntry(id) {
    editingId = id;
    const entry = logs.find(e => e.id === id);
    if (!entry) return;

    document.getElementById("editDate").value = entry.date;
    document.getElementById("editTime").value = entry.time;
    document.getElementById("errorMsg").textContent = "";

    document.getElementById("modalOverlay").style.display = "flex";
}

function closeModal() {
    document.getElementById("modalOverlay").style.display = "none";
}

/* ------------------------------
   SAVE EDIT
------------------------------ */
function saveEdit() {
    const date = document.getElementById("editDate").value;
    const time = document.getElementById("editTime").value;
    const errorElem = document.getElementById("errorMsg");

    const dateRegex = /^\d{2}\/\d{2}\/\d{4}$/;
    const timeRegex = /^\d{2}:\d{2}$/;

    if (!dateRegex.test(date)) {
        errorElem.textContent = "Invalid date format";
        return;
    }
    if (!timeRegex.test(time)) {
        errorElem.textContent = "Invalid time format";
        return;
    }

    const entry = logs.find(e => e.id === editingId);
    if (!entry) return;

    entry.date = date;
    entry.time = time;

    const dt = parseUkDateTime(date, time);
    entry.timestamp = dt.getTime();

    logs.sort((a, b) => b.timestamp - a.timestamp);

    calculateShifts();
    localStorage.setItem("timeLogs", JSON.stringify(logs));

    closeModal();
    renderTable(true, editingId);
}

/* ------------------------------
   DELETE ENTRY
------------------------------ */
function deleteEntry(id) {
    logs = logs.filter(e => e.id !== id);
    calculateShifts();
    localStorage.setItem("timeLogs", JSON.stringify(logs));
    renderTable();
}

/* ------------------------------
   RENDER TABLE
------------------------------ */
function renderTable(animate = false, editedId = null) {
    const tbody = document.querySelector("#logTable tbody");
    tbody.innerHTML = "";

    let lastDate = "";
    let toggle = false;

    logs.forEach(row => {
        if (row.date !== lastDate) {
            toggle = !toggle;
            lastDate = row.date;
        }

        const tr = document.createElement("tr");
        tr.className = toggle ? "dayA" : "dayB";

        if (animate && row.id === editedId) {
            tr.classList.add("edited");
        }

        tr.innerHTML = `
            <td>${row.shift || ""}</td>
            <td class="${row.action === 'Clock In' ? 'action-in' : 'action-out'}">${row.action}</td>
            <td>${row.date}</td>
            <td>${row.time}</td>
            <td>${row.hours || ""}</td>
            <td class="actionCell">
                <button class="editBtn" onclick="editEntry('${row.id}')">‚úèÔ∏è</button>
            </td>
            <td class="actionCell">
                <button class="deleteBtn" onclick="deleteEntry('${row.id}')">üóëÔ∏è</button>
            </td>
        `;

        tbody.appendChild(tr);
    });

    updateButtons();
}

/* ------------------------------
   DOWNLOAD CSV
------------------------------ */
function downloadCSV() {
    let csv = "Shift,Action,Date,Time,Hours\n";
    logs.forEach(row => {
        csv += `${row.shift || ""},${row.action},${row.date},${row.time},${row.hours || ""}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "time_log.csv";
    a.click();

    URL.revokeObjectURL(url);
}

/* ------------------------------
   RESET ALL DATA
------------------------------ */
function confirmReset() {
    if (!confirm("Are you sure you want to delete ALL data?")) return;

    logs = [];
    localStorage.removeItem("timeLogs");
    renderTable();
    alert("All data has been reset.");
}

/* ------------------------------
   INITIAL LOAD
------------------------------ */
logs.sort((a, b) => b.timestamp - a.timestamp);
calculateShifts();
renderTable();

</script>
</body>
</html>
